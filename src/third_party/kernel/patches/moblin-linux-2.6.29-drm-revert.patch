From ee977685870767221dc763338bb6ed5fd83f65be Mon Sep 17 00:00:00 2001
From: Yong Wang <yong.y.wang@intel.com>
Date: Tue, 6 Jan 2009 15:13:41 +0800
Subject: [PATCH] Revert "drm/i915: GEM on PAE has problems - disable it for now."

This reverts commit ac5c4e76180a74c7f922f6fa71ace0cef45fa433.
---
 drivers/gpu/drm/i915/i915_dma.c |   10 +---------
 drivers/gpu/drm/i915/i915_drv.h |    2 --
 2 files changed, 1 insertion(+), 11 deletions(-)

Index: linux-2.6.29/drivers/gpu/drm/i915/i915_dma.c
===================================================================
--- linux-2.6.29.orig/drivers/gpu/drm/i915/i915_dma.c
+++ linux-2.6.29/drivers/gpu/drm/i915/i915_dma.c
@@ -729,7 +729,7 @@ static int i915_getparam(struct drm_devi
 		value = dev->pci_device;
 		break;
 	case I915_PARAM_HAS_GEM:
-		value = dev_priv->has_gem;
+		value = 1;
 		break;
 	case I915_PARAM_NUM_FENCES_AVAIL:
 		value = dev_priv->num_fence_regs - dev_priv->fence_reg_start;
@@ -1109,14 +1109,6 @@ int i915_driver_load(struct drm_device *
 			 "performance may suffer.\n");
 	}
 
-#ifdef CONFIG_HIGHMEM64G
-	/* don't enable GEM on PAE - needs agp + set_memory_* interface fixes */
-	dev_priv->has_gem = 0;
-#else
-	/* enable GEM by default */
-	dev_priv->has_gem = 1;
-#endif
-
 	dev->driver->get_vblank_counter = i915_get_vblank_counter;
 	if (IS_GM45(dev))
 		dev->driver->get_vblank_counter = gm45_get_vblank_counter;
Index: linux-2.6.29/drivers/gpu/drm/i915/i915_drv.h
===================================================================
--- linux-2.6.29.orig/drivers/gpu/drm/i915/i915_drv.h
+++ linux-2.6.29/drivers/gpu/drm/i915/i915_drv.h
@@ -129,8 +129,6 @@ struct drm_i915_fence_reg {
 typedef struct drm_i915_private {
 	struct drm_device *dev;
 
-	int has_gem;
-
 	void __iomem *regs;
 
 	drm_i915_ring_buffer_t ring;
